# Log

**目前的想法：**

- [ ] 目前先尝试让pi-slam和map2dfusion合并到一起运行，不考虑一些逻辑关系之类的问题，先把线程问题解决掉！
- [ ] 尝试让map2dfusion读取pi-slam的frame信息，通过这种方式运行
- [ ] 在原pi-slam中合适的地方加入一个RANSAC计算plane参数的部分，计算好之后输出结果和计算需要的拍数
- [ ] 将上面这一步单独提取出来，用来启动map2dfusion
- [ ] 如果使用plane启动map2dfusion有困难，可以直接让plane为空，然后map2dfusion启动后阻塞。（目前想到最简单的方法）

另外：map2dfusion中的错误还是要找出来，不过打算先等前面几步做好了再来找。

### 1月29日

**今天的安排：**

- [ ] 解决参数传递的问题（pi-slam和map2dfusion里面应该有一些同名的参数，要改一下！）
- [ ] 考虑如何让不同线程进行数据交换


**发现的问题：**



### 1月27日

**今天的安排：**

- 继续尝试让pi-slam和map2dfusion合并到一起
  - 先让map2dfusion在线程中跑起来，解决昨天的一些问题
  - 让pi-slam也能够跑起来（这时候应该会有一个参数传递的问题，比如conf=xxxxx这部分）
  - 尝试解决参数传递的问题

**发现的问题：**

- 因为`svar.ParseMain(argc, argv);`在线程中使用的时候会发生段错误（不清楚具体原因），我把它移动到了main函数里面（本来就应该放在main里面呀），结果main函数中确实能够成功解析，但是解析出来的数据线程中居然看不到（奇怪的问题，这个问题之前没有遇到过，你可以写一个简单的多线程测试程序试试，找到到底哪里错了；另外我在代码标注FIXME有可能问题产生的地方，你需要好好读一下里面代码，看看里面到底做了什么，确认是否是这里的问题）。

  原因：svar用的单例模式是懒汉式，在多线程并发下，可能有多个线程同时调用getinstance，然后产生了多个实例，无法保证实例唯一。
  
- 突然有了灵感，终于让pi-slam和map2dfusion一起跑了，也避开了上面这个问题，不过目前还需要做的事情比较多：

  - 解决参数的问题（pi-slam和map2dfusion里面应该有一些同名的参数，要改一下！）

    感觉改改名称可能就好了

  - 想办法让不同线程进行数据交换，这样就可以先让pi-slam计算出plane再交给map2dfusion使用了

    这里要做的事情可能麻烦一些

### 1月26日

**今天的安排：**

- 尝试pi-slam和map2dfusion合并到一起，仅仅是让两个同时跑起来

**一些问题：**

- 继承之后再重写出了点问题，目前感觉最好的还是在pi-slam中进行修改

- 又遇到了重定义的问题，因为在pi-slam中引入了map2dfusion需要的一些头文件，这些东西又冲突了！

  > 我感觉还是给pi-slam和map2dfusion分开，之后在pi-slam-fusion里面可以把这些线程组织起来。
  >
  > 另外我感觉不应该冲突，不然main.cpp里面的代码是跑不起来的。。。。
  
- 把map2dfusion的主函数改成能够用pthread的了，但是单独运行没有问题，放到线程里面就会报错。

  目前发现是svar这部分出的问题，打算把它放到线程外看看。

